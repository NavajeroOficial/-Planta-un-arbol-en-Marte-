<script type="module">
    import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    let userId = null;
    let treeCount = 0;
    const planet = document.getElementById('planet');
    const treeCountElement = document.getElementById('treeCount');
    const userNameSection = document.getElementById('userNameSection');
    const gameSection = document.getElementById('gameSection');

    // Función para comenzar el juego
    document.getElementById('startButton').addEventListener('click', () => {
        userId = document.getElementById('userName').value.trim();
        if (userId) {
            // Mostrar el juego y ocultar el formulario de nombre
            userNameSection.style.display = 'none';
            gameSection.style.display = 'block';

            // Obtener el contador de árboles desde Firebase
            updateTreeCount(userId);
        } else {
            alert("Por favor ingresa tu nombre.");
        }
    });

    // Función para plantar un árbol
    document.getElementById('plantTreeButton').addEventListener('click', () => {
        if (userId) {
            // Llama a la función de Firebase para aumentar el contador de árboles
            plantTree(userId);

            // Aumenta el contador en la interfaz
            treeCount++;
            treeCountElement.textContent = treeCount;

            // Crear un nuevo árbol en el planeta
            const tree = document.createElement('div');
            tree.className = 'tree';
            const x = Math.random() * 280;
            const y = Math.random() * 250;
            tree.style.left = x + 'px';
            tree.style.bottom = y + 'px';
            planet.appendChild(tree);
        }
    });

    // Función para actualizar el contador de árboles desde Firebase
    function updateTreeCount(userId) {
        const userRef = ref(database, 'users/' + userId);
        get(userRef).then((snapshot) => {
            if (snapshot.exists()) {
                const currentCount = snapshot.val().trees;
                treeCount = currentCount;
                treeCountElement.textContent = treeCount;
            } else {
                treeCount = 0;
                treeCountElement.textContent = treeCount;
            }
        }).catch((error) => {
            console.error("Error al obtener el contador:", error);
        });
    }

    // Función para actualizar el contador de árboles en Firebase
    function plantTree(userId) {
        const userRef = ref(database, 'users/' + userId);
        get(userRef).then((snapshot) => {
            if (snapshot.exists()) {
                const currentCount = snapshot.val().trees;
                update(userRef, {
                    trees: currentCount + 1
                });
            } else {
                set(userRef, {
                    trees: 1
                });
            }
        }).catch((error) => {
            console.error("Error al actualizar el contador:", error);
            
        });
    }
</script>
<script type="module" src="firebase.js"></script>
